-- Geração de Modelo físico
-- Sql ANSI 2003 - brModelo.

CREATE TABLE DISCIPLINA (
DIS_CODIGO BIGINT NOT NULL,
DIS_NOME VARCHAR(60) NOT NULL,
DIS_LIMITE_FALTAS INTEGER NOT NULL,
CONSTRAINT DISCIPLINA_pk PRIMARY KEY(DIS_CODIGO)
);

CREATE TABLE ALUNO (
ALU_RA BIGINT NOT NULL,
ALU_NOME VARCHAR(60)NOT NULL,
CONSTRAINT ALUNO_pk PRIMARY KEY(ALU_RA)
);

CREATE TABLE MINISTRADA_EM (
CUR_CODIGO INTEGER NOT NULL,
DIS_CODIGO BIGINT NOT NULL,
MIN_SERIE INTEGER NOT NULL,
MIN_TURMA CHAR(1) NOT NULL,
MIN_PERIODO_LETIVO VARCHAR(5) NOT NULL,
CONSTRAINT MINISTRADA_EM_pk PRIMARY KEY(CUR_CODIGO,DIS_CODIGO),
CONSTRAINT MINISTRADA_EM_FK_DISCIPLINA
                       FOREIGN KEY(DIS_CODIGO) REFERENCES DISCIPLINA (DIS_CODIGO)
);

CREATE TABLE LISTA (
LIS_CODIGO BIGINT NOT NULL,
CUR_CODIGO INTEGER NOT NULL,
DIS_CODIGO BIGINT NOT NULL,
LIS_DATA DATE NOT NULL,
PRO_CODIGO INTEGER NOT NULL,
LIS_MATERIA_LECIONADA BLOB SUB_TYPE 1,
CONSTRAINT LISTA_pk PRIMARY KEY(LIS_CODIGO),
CONSTRAINT LISTA_FK_DISCIPLINA FOREIGN KEY(DIS_CODIGO) REFERENCES DISCIPLINA (DIS_CODIGO)
);

CREATE TABLE PRESENCA (
LIS_CODIGO BIGINT NOT NULL,
ALU_RA BIGINT NOT NULL,
PRE_PRESENTE CHAR(1) NOT NULL CHECK (PRE_PRESENTE IN ('P','F')),
CONSTRAINT PRESENCA_pk PRIMARY KEY(LIS_CODIGO,ALU_RA),
CONSTRAINT PRESENCA_FK_LISTA FOREIGN KEY(LIS_CODIGO) REFERENCES LISTA (LIS_CODIGO) ON UPDATE CASCADE ON DELETE CASCADE,
CONSTRAINT PRESENCA_FK_ALUNO FOREIGN KEY(ALU_RA) REFERENCES ALUNO (ALU_RA) ON UPDATE CASCADE
);

CREATE TABLE PROFESSOR (
PRO_CODIGO INTEGER NOT NULL,
PRO_NOME VARCHAR(60) NOT NULL,
CONSTRAINT PROFESSOR_pk PRIMARY KEY(PRO_CODIGO)
);

CREATE TABLE CURSO (
CUR_CODIGO INTEGER NOT NULL,
CUR_NOME VARCHAR(50)NOT NULL,
CUR_PERIODO VARCHAR(12)NOT NULL CHECK (CUR_PERIODO IN ('NOTURNO','DIURNO','VESPERTINO')),
CONSTRAINT CURSO_pk PRIMARY KEY(CUR_CODIGO)
);

CREATE TABLE ALUNO_REALIZA_CURSO (
ALU_RA BIGINT NOT NULL,
CUR_CODIGO INTEGER NOT NULL,
CONSTRAINT ALUNO_REALIZA_CURSO_pk PRIMARY KEY(ALU_RA,CUR_CODIGO),
CONSTRAINT ALUNO_REALIZA_CURSO_FK_ALUNO FOREIGN KEY(ALU_RA) REFERENCES ALUNO (ALU_RA) ON UPDATE CASCADE ON DELETE CASCADE,
CONSTRAINT ALUNO_REALIZA_CURSO_FK_CURSO FOREIGN KEY(CUR_CODIGO) REFERENCES CURSO (CUR_CODIGO) ON UPDATE CASCADE ON DELETE CASCADE
);

CREATE TABLE CURSO_CONTEM_PROFESSOR (
PRO_CODIGO INTEGER NOT NULL,
CUR_CODIGO INTEGER NOT NULL,
CONSTRAINT CURSO_CONTEM_PROFESSOR_pk PRIMARY KEY(PRO_CODIGO,CUR_CODIGO),
CONSTRAINT CURSO_CONTEM_PROFESSOR_FK
                       FOREIGN KEY(PRO_CODIGO) REFERENCES PROFESSOR (PRO_CODIGO) ON UPDATE CASCADE ON DELETE CASCADE,
CONSTRAINT CURSO_CONTEM_CURSO_FK
                      FOREIGN KEY(CUR_CODIGO) REFERENCES CURSO (CUR_CODIGO) ON UPDATE CASCADE ON DELETE CASCADE
);

ALTER TABLE MINISTRADA_EM ADD CONSTRAINT MINISTRADA_EM_FK_CURSO
                                                     FOREIGN KEY(CUR_CODIGO) REFERENCES CURSO (CUR_CODIGO) ON UPDATE CASCADE ON DELETE CASCADE ;
ALTER TABLE LISTA ADD CONSTRAINT LISTA_FK_CURSO 
                                 FOREIGN KEY(CUR_CODIGO) REFERENCES CURSO (CUR_CODIGO) ON UPDATE CASCADE ;
ALTER TABLE LISTA ADD CONSTRAINT LISTA_FK_PROFESSOR
                                 FOREIGN KEY(PRO_CODIGO) REFERENCES PROFESSOR (PRO_CODIGO) ON UPDATE CASCADE ;
